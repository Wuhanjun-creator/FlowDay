<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>节奏洞察 - FlowDay</title>
    <link rel="stylesheet" href="styles.css" />
    <script>
      // 预加载主题 - 在页面渲染前应用，防止闪烁
      (function() {
        const cachedTheme = localStorage.getItem('flowday-current-theme');
        if (cachedTheme) {
          try {
            const theme = JSON.parse(cachedTheme);
            const root = document.documentElement;
            root.style.setProperty('--bg', theme.background);
            root.style.setProperty('--primary', theme.primary);
            root.style.setProperty('--accent', theme.accent);
            // 计算派生颜色
            const isDark = parseInt(theme.background.replace('#', ''), 16) < 0x888888;
            root.style.setProperty('--text', isDark ? '#f5f5f5' : '#111111');
            root.style.setProperty('--muted', isDark ? '#a1a1aa' : '#6b7280');
            root.style.setProperty('--panel', isDark ? 'rgba(255,255,255,0.06)' : 'rgba(255,255,255,0.7)');
            root.style.setProperty('--panel-strong', isDark ? 'rgba(255,255,255,0.1)' : 'rgba(255,255,255,0.92)');
            root.style.setProperty('--panel-deep', isDark ? '#0f0f0f' : '#e6e4dc');
            root.style.setProperty('--border', isDark ? 'rgba(255,255,255,0.08)' : 'rgba(0,0,0,0.08)');
            root.style.setProperty('--accent-soft', theme.accent + '40');
            root.style.setProperty('--glow', theme.accent + '26');
            root.style.setProperty('--button-solid', isDark ? '#ffffff' : '#111111');
            root.style.colorScheme = isDark ? 'dark' : 'light';
          } catch (e) {}
        }
      })();
    </script>
  </head>
  <body class="page-app">
    <div class="ambient" aria-hidden="true">
      <span class="orb orb-a"></span>
      <span class="orb orb-b"></span>
      <span class="orb orb-c"></span>
    </div>

    <div class="app-shell">
      <aside class="sidebar">
        <div class="brand">
          <div class="brand-mark">FlowDay</div>
          <div class="brand-tagline tagline-rotator tagline-small">
            <span>让每一天<br />在正确的节律中慢慢<br />绽放。</span>
            <span>Let every day <br bloom slowly,<br />in the right rhythm.</span>
          </div>
        </div>
        <nav class="nav" aria-label="primary">
          <a href="overview.html" class="nav-item" data-nav="overview">
            <span data-i18n="navOverview">今日概览</span>
          </a>
          <a href="insights.html" class="nav-item active" data-nav="insights">
            <span data-i18n="navInsights">节奏洞察</span>
          </a>
          <a href="journal.html" class="nav-item" data-nav="journal">
            <span data-i18n="navJournal">记录今日</span>
          </a>
          <a href="habits.html" class="nav-item" data-nav="habits">
            <span data-i18n="navHabits">习惯跟踪</span>
          </a>
          <a href="quicklist.html" class="nav-item" data-nav="quicklist">
            <span data-i18n="navQuicklist">即时清单</span>
          </a>
          <a href="settings.html" class="nav-item" data-nav="settings">
            <span data-i18n="navSettings">应用设置</span>
          </a>
        </nav>
      </aside>

      <div class="app-main">
        <header class="topbar">
          <div class="welcome-block">
            <h2 class="greeting" id="greeting"></h2>
            <div class="date-value" id="dateLabel"></div>
          </div>
        </header>

        <main class="content">
          <div class="page page-insights active">
            <section class="card insights">
              <div class="card-head">
                <h2 data-i18n="insightsTitle">节奏洞察</h2>
                <span class="chip" id="rangeLabel" data-i18n="rangeWeek">近 7 天</span>
              </div>
              
              <div class="insights-body">
                <div class="insights-visuals">
                  <div class="insights-row">
                    <div class="insights-summary">
                      <div class="stat">
                        <div class="stat-value" id="rangeTotal">0</div>
                        <div class="stat-label" data-i18n="statTotal">任务总数</div>
                      </div>
                      <div class="stat">
                        <div class="stat-value" id="rangeDone">0</div>
                        <div class="stat-label" data-i18n="statDone">已完成</div>
                      </div>
                      <div class="stat">
                        <div class="stat-value" id="rangeRate">0%</div>
                        <div class="stat-label" data-i18n="insightsRate">完成率</div>
                      </div>
                    </div>
                    
                    <div class="progress-block insights-ring-block">
                      <div class="progress-ring" id="insightsRing" style="--progress: 0%">
                        <div class="progress-center">
                          <div class="progress-value" id="insightsRingValue">0%</div>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <div class="insights-chart" id="rangeChart"></div>
                  <div class="empty" id="rangeEmpty" data-i18n="rangeEmpty">这段时间还没有任务记录</div>
                </div>

                <div class="insights-controls-sidebar">
                  <h3 data-i18n="timeRange">时间范围</h3>
                  <div class="control-group">
                    <label>
                      <span data-i18n="rangeStart">开始</span>
                      <input id="rangeStart" type="date" />
                    </label>
                    <label>
                      <span data-i18n="rangeEnd">结束</span>
                      <input id="rangeEnd" type="date" />
                    </label>
                  </div>
                  <div class="range-actions vertical">
                    <button class="filter active" type="button" data-range="7" data-i18n="rangeWeek">近 7 天</button>
                    <button class="filter" type="button" data-range="14" data-i18n="rangeFortnight">近 14 天</button>
                    <button class="filter" type="button" data-range="30" data-i18n="rangeMonth">近 30 天</button>
                  </div>
                </div>
              </div>
            </section>
          </div>
        </main>
      </div>
    </div>

    <script type="module" src="src/pages/insights.js"></script>
  </body>
</html>
